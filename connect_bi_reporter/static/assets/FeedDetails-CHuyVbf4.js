import{s as Y,a as ue,V as G}from"./connect-BV-2I-fJ.js";import{o as t,b as i,g as Z,n as ee,m as W,u as ce,r as te,s as ae,x as I,k as n,j as l,h as m,e as w,l as A,t as B,a as g,c as z,F as q,f as X,d as v,p as se,q as oe,L as pe,I as _e}from"./vendor-1x2ovGvJ.js";import{D as ve,_ as me,v as J,L as le,a as M,S as j,b as ie,g as fe,c as ye,d as xe,e as be}from"./main-DwndtqKj.js";import{_ as O,u as de,C as F,D as b,A as ge,r as H}from"./ActionsMenu-BdIbYJG3.js";const ke={__name:"DetailItemGroup",props:{separated:{type:Boolean,default:!1}},setup(o){return(_,p)=>(t(),i("div",{class:ee(["detail-item-group",{"detail-item-group_separated":o.separated}])},[Z(_.$slots,"default",{},void 0,!0)],2))}},K=O(ke,[["__scopeId","data-v-1639276f"]]),he={__name:"EditFeedDialog",props:W({feed:{type:Object,required:!0}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:W(["updated"],["update:modelValue"]),setup(o,{emit:_}){const p=ce(o,"modelValue"),a=o,u=_,k=Y(),{request:x}=de(k,!0),s=te({credentialId:"",fileName:"",description:""}),h={credentialId:[J.required()],fileName:[J.required()]},f=[{key:"destination",label:"Destination",includes:["credentialId","fileName"]}],y=async()=>{await x(`/api/feeds/${a.feed.id}`,"PUT",{credential:{id:s.credentialId},file_name:s.fileName,description:s.description}),u("updated")};return ae([()=>a.feed,p],()=>{var T;s.credentialId=((T=a.feed.credential)==null?void 0:T.id)||"",s.fileName=a.feed.file_name||"",s.description=a.feed.description||""},{immediate:!0}),(T,c)=>(t(),I(me,{modelValue:p.value,"onUpdate:modelValue":c[3]||(c[3]=d=>p.value=d),form:s,onSubmit:y,rules:h,tabs:f,title:"Edit Feed",mode:"edit"},{destination:n(()=>[l(ve,{"credential-id":s.credentialId,"onUpdate:credentialId":c[0]||(c[0]=d=>s.credentialId=d),"file-name":s.fileName,"onUpdate:fileName":c[1]||(c[1]=d=>s.fileName=d),description:s.description,"onUpdate:description":c[2]||(c[2]=d=>s.description=d)},null,8,["credential-id","file-name","description"])]),_:1},8,["modelValue","form"]))}},Te={class:"reset-button link-button"},Ie=["iconName","color"],we={__name:"LinkButton",props:{text:{type:String,default:""},icon:{type:String,default:""}},setup(o){return(_,p)=>(t(),i("button",Te,[o.icon?(t(),i("ui-icon",{key:0,iconName:o.icon,size:"16px",color:m(F).NICE_BLUE},null,8,Ie)):w("",!0),Z(_.$slots,"default",{},()=>[A(B(o.text),1)],!0)]))}},Q=O(we,[["__scopeId","data-v-82daa974"]]),De=o=>(se("data-v-9e3f6989"),o=o(),oe(),o),$e={class:"uploads-table"},Se=["headers","totalItems","currentPage"],Ce={key:3},Ue=["iconName","iconColor","text"],Ne=De(()=>v("span",{class:"dot-separator"},null,-1)),Fe={key:4,class:"uploads-table__actions"},Be={__name:"UploadsTable",props:{feedId:{type:String,required:!0}},setup(o){const _=o,{items:p,page:a,total:u,load:k,next:x,previous:s}=ue(`/api/feeds/${_.feedId}/uploads`),h=g(!1),f=g([]),y=g([]),T=z(()=>y.value.some(e=>e.isFailed)),c=()=>{y.value=p.value.map(e=>({id:e.id,date:e.events.updated.at,report:f.value.find(L=>L.id===e.report.id),status:ie[e.status],file:{name:V(e.report.id),size:fe(e.size||0)},isFailed:e.status===ye.FAILED}))},d=async()=>{if(!p.value.length){y.value=[];return}const e=p.value.map(L=>L.report.id);f.value=await H(`/public/v1/reporting/reports?(in(id,(${e.join(",")})))`)},E=async()=>{await D(k)},C=async()=>{await D(x)},P=async()=>{await D(s)},D=async e=>{h.value=!0,await e(),await d(),c(),h.value=!1},V=e=>`${e}.zip`,$=e=>`/public/v1/reporting/reports/${e}/download`,U=z(()=>{const e=[{key:"date",text:"Date",width:"190px"},{key:"report",text:"Report"},{key:"file",text:"File",width:"165px"},{key:"status",text:"Status",width:"145px"}];return T.value&&e.push({key:"actions",width:"36px"}),e}),N=de(Y()),R=async e=>{await N.request(`/api/feeds/${_.feedId}/uploads/${e.id}/retry`,"POST"),await E()},ne=({report:e})=>xe($(e.id)),re=e=>te([{icon:"googleRefreshBaseline",key:"retry",text:"Retry",loading:N.loading,handler:()=>R(e)}]);return E(),(e,L)=>(t(),i("div",$e,[h.value?(t(),I(le,{key:0})):(t(),i("ui-complex-table",{key:1,headers:U.value,totalItems:m(u),currentPage:m(a),fixed:"",onNextClicked:C,onPreviousClicked:P},[(t(!0),i(q,null,X(y.value,r=>(t(),i("tr",{key:r.id,class:"uploads-table__row"},[(t(!0),i(q,null,X(U.value,S=>(t(),i("td",{key:S.key},[S.key==="date"?(t(),I(M,{key:0,date:r.date},null,8,["date"])):S.key==="report"?(t(),I(b,{key:1,assistiveText:r.report.id},{"body-text":n(()=>[l(j,{to:m(G).reportDetails,params:r.report.id},{default:n(()=>[A(B(r.report.name),1)]),_:2},1032,["to","params"])]),_:2},1032,["assistiveText"])):S.key==="file"?(t(),I(Q,{key:2,text:r.file.name,icon:"googleFileDownloadBaseline",onClick:Je=>ne(r)},null,8,["text","onClick"])):S.key==="status"?(t(),i("span",Ce,[v("ui-status",{iconName:r.status.icon,iconColor:r.status.color,text:r.status.text},null,8,Ue),r.isFailed?(t(),i(q,{key:0},[Ne,l(Q,{text:"Details"})],64)):w("",!0)])):S.key==="actions"?(t(),i("div",Fe,[r.isFailed?(t(),I(ge,{key:0,actions:re(r)},null,8,["actions"])):w("",!0)])):w("",!0)]))),128))]))),128))],40,Se))]))}},Ee=O(Be,[["__scopeId","data-v-9e3f6989"]]),Ve=o=>(se("data-v-d96aa759"),o=o(),oe(),o),Re=["title"],Le={slot:"actions",class:"header-actions"},qe=["backgroundColor","color"],Ae=Ve(()=>v("span",null,"Edit",-1)),ze=[Ae],Oe=["backgroundColor"],Pe=["color"],Ge={class:"header"},Me=["iconName","iconColor","text"],je=["currentTab"],He={key:0,slot:"general",class:"general-tab"},We={key:1,slot:"uploads",class:"uploads-tab"},Xe={__name:"FeedDetails",setup(o){const _=pe(),p=_e(),a=g({}),u=g({}),k=g(!1),x=z(()=>_.params.id),s=z(()=>ie[a.value.status]),h=[{value:"general",label:"General"},{value:"uploads",label:"Uploads"}],f=g("general"),y=()=>{p.replace({name:"feeds"})},T=async()=>{a.value=await H(`/api/feeds/${x.value}`)},c=async()=>{u.value=await H(`/public/v1/reporting/schedules/${a.value.schedule.id}`)},d=async()=>{k.value=!0,await T(),await c(),k.value=!1},E=({detail:D})=>{f.value=D},C=g(!1),P=()=>{C.value=!0};return ae(x,d,{immediate:!0}),(D,V)=>(t(),i("ui-view",{title:x.value,assistiveTitle:"Feed Details",style:{height:"inherit"},showBackButton:"",onGoBack:y},[k.value?(t(),I(le,{key:0})):(t(),i(q,{key:1},[v("div",Le,[v("ui-button",{class:"header-button",backgroundColor:m(F).WHITE,color:m(F).TEXT,height:"36px",onClicked:P},ze,40,qe),l(be,{feed:a.value,onEnabled:d,onDisabled:d,onUploaded:d,onDeleted:y},{default:n(()=>[v("ui-button",{class:"header-button header-button_menu",backgroundColor:m(F).WHITE,height:"36px",width:"36px"},[v("ui-icon",{class:"header-button__trigger-icon",color:m(F).TEXT,iconName:"googleArrowDropDownBaseline"},null,8,Pe)],8,Oe)]),_:1},8,["feed"])]),v("div",Ge,[l(K,null,{default:n(()=>{var $,U;return[l(b,{title:"Report Schedule",assistiveText:u.value.id},{"body-text":n(()=>[l(j,{to:m(G).reportsScheduleDetails,params:u.value.id},{default:n(()=>[A(B(u.value.name),1)]),_:1},8,["to","params"])]),_:1},8,["assistiveText"]),l(b,{title:"Report Template",assistiveText:`${($=u.value.template)==null?void 0:$.id} • ${(U=u.value.template)==null?void 0:U.local_id}`},{"body-text":n(()=>{var N;return[l(j,{to:m(G).reportTemplateDetails,params:(N=u.value.template)==null?void 0:N.id},{default:n(()=>{var R;return[A(B((R=u.value.template)==null?void 0:R.name),1)]}),_:1},8,["to","params"])]}),_:1},8,["assistiveText"]),l(b,{title:"Status"},{content:n(()=>[s.value?(t(),i("ui-status",{key:0,iconName:s.value.icon,iconColor:s.value.color,text:s.value.text},null,8,Me)):w("",!0)]),_:1})]}),_:1})]),v("ui-tabs",{currentTab:f.value,tabs:h,onClickTab:E},[f.value==="general"?(t(),i("div",He,[l(b,{title:"Credentials",bodyText:a.value.credential.id},null,8,["bodyText"]),l(b,{title:"Description"},{"body-text":n(()=>[v("span",{class:ee({"assistive-color":!a.value.description})},B(a.value.description||"—"),3)]),_:1}),l(K,{separated:""},{default:n(()=>[l(b,{title:"Created",assistiveText:a.value.events.created.by.id},{"body-text":n(()=>[l(M,{date:a.value.events.created.at},null,8,["date"])]),_:1},8,["assistiveText"]),l(b,{title:"Updated",assistiveText:a.value.events.updated.by.id},{"body-text":n(()=>[l(M,{date:a.value.events.updated.at},null,8,["date"])]),_:1},8,["assistiveText"])]),_:1})])):w("",!0),f.value==="uploads"?(t(),i("div",We,[l(Ee,{feedId:x.value},null,8,["feedId"])])):w("",!0)],40,je)],64)),l(he,{modelValue:C.value,"onUpdate:modelValue":V[0]||(V[0]=$=>C.value=$),feed:a.value,onUpdated:d},null,8,["modelValue","feed"])],40,Re))}},et=O(Xe,[["__scopeId","data-v-d96aa759"]]);export{et as default};
