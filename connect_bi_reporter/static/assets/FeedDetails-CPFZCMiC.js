import{s as q,a as se,V as W}from"./connect-CssGEuJz.js";import{o as a,b as i,g as X,n as j,m as L,u as oe,r as J,x as K,z as x,k as c,j as d,l as A,t as N,c as U,h as e,F as C,f as O,d as p,e as T,p as Q,q as Y,M as de,s as ie,a as M}from"./vendor-QZT6KSBV.js";import{D as le,_ as ne,v as G,S as Z,g as re,a as ce,L as ee,b as R,c as te,C as D,A as ue,d as pe,e as _e}from"./main-CHyCxgVG.js";import{_ as V,u as z,D as y}from"./DetailItem-BAhWrCsF.js";const fe={__name:"DetailItemGroup",props:{separated:{type:Boolean,default:!1}},setup(l){return(_,f)=>(a(),i("div",{class:j(["detail-item-group",{"detail-item-group_separated":l.separated}])},[X(_.$slots,"default",{},void 0,!0)],2))}},H=V(fe,[["__scopeId","data-v-98561949"]]),me={__name:"EditFeedDialog",props:L({feed:{type:Object,required:!0}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:L(["updated"],["update:modelValue"]),setup(l,{emit:_}){const f=oe(l,"modelValue"),m=l,w=_,h=q(),{request:n}=z(h,!0),s=J({credentialId:"",fileName:"",description:""}),b={credentialId:[G.required()],fileName:[G.required()]},F=[{key:"destination",label:"Destination",includes:["credentialId","fileName"]}],k=async()=>{await n(`/api/feeds/${m.feed.id}`,"PUT",{credential:{id:s.credentialId},file_name:s.fileName,description:s.description}),w("updated")};return K([()=>m.feed,f],()=>{var v;s.credentialId=((v=m.feed.credential)==null?void 0:v.id)||"",s.fileName=m.feed.file_name||"",s.description=m.feed.description||""},{immediate:!0}),(v,r)=>(a(),x(ne,{modelValue:f.value,"onUpdate:modelValue":r[3]||(r[3]=u=>f.value=u),form:s,"on-submit":k,rules:b,tabs:F,title:"Edit Feed",mode:"edit"},{destination:c(()=>[d(le,{"credential-id":s.credentialId,"onUpdate:credentialId":r[0]||(r[0]=u=>s.credentialId=u),"file-name":s.fileName,"onUpdate:fileName":r[1]||(r[1]=u=>s.fileName=u),description:s.description,"onUpdate:description":r[2]||(r[2]=u=>s.description=u)},null,8,["credential-id","file-name","description"])]),_:1},8,["modelValue","form"]))}},be={class:"link-button reset-button"},ve={__name:"LinkButton",props:{text:{type:String,default:""}},setup(l){return(_,f)=>(a(),i("button",be,[X(_.$slots,"default",{},()=>[A(N(l.text),1)],!0)]))}},P=V(ve,[["__scopeId","data-v-fb10cc6c"]]),ke=l=>(Q("data-v-a87aab40"),l=l(),Y(),l),ye={class:"uploads-table"},ge=["headers","total-items","current-page"],xe={key:0,class:"assistive-color"},he={key:3},Ie=["icon-name","icon-color","text"],$e=ke(()=>p("span",{class:"dot-separator"},null,-1)),De={key:4,class:"uploads-table__actions"},Te=["background-color","onClicked"],we=["color"],Fe={__name:"UploadsTable",props:{feedId:{type:String,required:!0}},setup(l){const _=l,{items:f,page:m,total:w,load:h,loading:n,next:s,previous:b}=se(`/api/feeds/${_.feedId}/uploads`),F=t=>`${t}.zip`,k=t=>`/public/v1/reporting/reports/${t}/download`,v=U(()=>f.value.map(t=>({id:t.id,date:t.events.updated.at,report:t.report,status:Z[t.status],file:{name:F(t.report.id),size:re(t.size||0)},isFailed:t.status===ce.FAILED}))),r=U(()=>v.value.some(t=>t.isFailed)),u=U(()=>[{key:"date",text:"Date",width:"190px"},{key:"report",text:"Report"},{key:"file",text:"File",width:"165px"},{key:"status",text:"Status",width:"145px"},{key:"actions",width:r.value?"80px":"36px"}]),I=z(q()),B=async t=>{await I.request(`/api/feeds/${_.feedId}/uploads/${t.id}/retry`,"POST"),await h()},S=({report:t})=>pe(k(t.id)),E=t=>J([{icon:"googleRefreshBaseline",key:"retry",text:"Retry",loading:I.loading,handler:()=>B(t)}]);return h(),(t,g)=>(a(),i("div",ye,[e(n)?(a(),x(ee,{key:0})):(a(),i("ui-complex-table",{key:1,headers:u.value,"total-items":e(w),"current-page":e(m),fixed:"",onNextClicked:g[0]||(g[0]=(...o)=>e(s)&&e(s)(...o)),onPreviousClicked:g[1]||(g[1]=(...o)=>e(b)&&e(b)(...o))},[(a(!0),i(C,null,O(v.value,o=>(a(),i("tr",{key:o.id,class:"uploads-table__row"},[(a(!0),i(C,null,O(u.value,$=>(a(),i("td",{key:$.key},[$.key==="date"?(a(),x(R,{key:0,date:o.date},null,8,["date"])):$.key==="report"?(a(),x(y,{key:1},{"body-text":c(()=>[d(te,{to:e(W).reportDetails,params:o.report.id},{default:c(()=>[A(N(o.report.id),1)]),_:2},1032,["to","params"])]),_:2},1024)):$.key==="file"?(a(),i(C,{key:2},[o.isFailed?(a(),i("span",xe," — ")):(a(),x(y,{key:1,"assistive-text":o.file.size},{"body-text":c(()=>[d(P,{text:o.file.name,onClick:ae=>S(o)},null,8,["text","onClick"])]),_:2},1032,["assistive-text"]))],64)):$.key==="status"?(a(),i("span",he,[p("ui-status",{"icon-name":o.status.icon,"icon-color":o.status.color,text:o.status.text},null,8,Ie),o.isFailed?(a(),i(C,{key:0},[$e,d(P,{text:"Details"})],64)):T("",!0)])):$.key==="actions"?(a(),i("div",De,[p("ui-button",{class:"actions-button","background-color":e(D).WHITE,height:"36px",width:"36px",onClicked:ae=>S(o)},[p("ui-icon",{class:"actions-button__trigger-icon",color:e(D).TEXT,"icon-name":"googleFileDownloadBaseline"},null,8,we)],40,Te),o.isFailed?(a(),x(ue,{key:0,actions:E(o)},null,8,["actions"])):T("",!0)])):T("",!0)]))),128))]))),128))],40,ge))]))}},Se=V(Fe,[["__scopeId","data-v-a87aab40"]]),Ce=l=>(Q("data-v-14e229dc"),l=l(),Y(),l),Ue=["title"],Ee={slot:"actions",class:"header-actions"},Ne=["background-color","color"],Ve=Ce(()=>p("span",null,"Edit",-1)),Be=[Ve],Re=["background-color"],qe=["color"],Ae={class:"header"},ze=["icon-name","icon-color","text"],Le=["current-tab"],Oe={key:0,slot:"general",class:"general-tab"},Me={key:1,slot:"uploads",class:"uploads-tab"},Ge={__name:"FeedDetails",setup(l){const _=de(),f=ie(),m=q(),{loading:w,request:h,result:n}=z(m),s=U(()=>_.params.id),b=U(()=>Z[n.status]),F=[{value:"general",label:"General"},{value:"uploads",label:"Uploads"}],k=M("general"),v=()=>{f.replace({name:"feeds"})},r=()=>h(`/api/feeds/${s.value}`),u=({detail:S})=>{k.value=S},I=M(!1),B=()=>{I.value=!0};return K(s,r,{immediate:!0}),(S,E)=>(a(),i("ui-view",{title:s.value,"assistive-title":"Feed Details",style:{height:"inherit"},"show-back-button":"",onGoBack:v},[e(w)?(a(),x(ee,{key:0})):(a(),i(C,{key:1},[p("div",Ee,[p("ui-button",{class:"header-button","background-color":e(D).WHITE,color:e(D).TEXT,height:"36px",onClicked:B},Be,40,Ne),d(_e,{feed:e(n),onEnabled:r,onDisabled:r,onUploaded:r,onDeleted:v},{default:c(()=>[p("ui-button",{class:"header-button header-button_menu","background-color":e(D).WHITE,height:"36px",width:"36px"},[p("ui-icon",{class:"header-button__trigger-icon",color:e(D).TEXT,"icon-name":"googleArrowDropDownBaseline"},null,8,qe)],8,Re)]),_:1},8,["feed"])]),p("div",Ae,[d(H,null,{default:c(()=>[d(y,{title:"Report Schedule"},{"body-text":c(()=>{var t;return[d(te,{to:e(W).reportsScheduleDetails,params:(t=e(n).schedule)==null?void 0:t.id},{default:c(()=>{var g;return[A(N((g=e(n).schedule)==null?void 0:g.id),1)]}),_:1},8,["to","params"])]}),_:1}),d(y,{title:"Status"},{content:c(()=>[b.value?(a(),i("ui-status",{key:0,"icon-name":b.value.icon,"icon-color":b.value.color,text:b.value.text},null,8,ze)):T("",!0)]),_:1})]),_:1})]),p("ui-tabs",{"current-tab":k.value,tabs:F,onClickTab:u},[k.value==="general"?(a(),i("div",Oe,[d(y,{title:"Credentials","body-text":e(n).credential.id},null,8,["body-text"]),d(y,{title:"Description"},{"body-text":c(()=>[p("span",{class:j({"assistive-color":!e(n).description})},N(e(n).description||"—"),3)]),_:1}),d(H,{separated:""},{default:c(()=>[d(y,{title:"Created","assistive-text":e(n).events.created.by.id},{"body-text":c(()=>[d(R,{date:e(n).events.created.at},null,8,["date"])]),_:1},8,["assistive-text"]),d(y,{title:"Updated","assistive-text":e(n).events.updated.by.id},{"body-text":c(()=>[d(R,{date:e(n).events.updated.at},null,8,["date"])]),_:1},8,["assistive-text"])]),_:1})])):T("",!0),k.value==="uploads"?(a(),i("div",Me,[d(Se,{"feed-id":s.value},null,8,["feed-id"])])):T("",!0)],40,Le)],64)),d(me,{modelValue:I.value,"onUpdate:modelValue":E[0]||(E[0]=t=>I.value=t),feed:e(n),onUpdated:r},null,8,["modelValue","feed"])],40,Ue))}},je=V(Ge,[["__scopeId","data-v-14e229dc"]]);export{je as default};
