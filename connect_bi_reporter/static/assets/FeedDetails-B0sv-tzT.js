import{s as q,a as se,V as W}from"./connect-D6CtjTYh.js";import{o as a,b as l,g as X,n as j,m as L,u as oe,r as J,x as K,z as x,k as c,j as d,l as A,t as E,c as N,h as e,F,f as O,d as p,e as D,p as Q,q as Y,M as de,s as le,a as M}from"./vendor-QZT6KSBV.js";import{D as ie,_ as ne,v as P,S as Z,g as re,a as ce,L as ee,b as R,c as te,d as ue,e as pe}from"./main-BP0is8Xw.js";import{_ as B,u as z,D as y,C as $,A as _e}from"./ActionsMenu-xnovkCKm.js";const fe={__name:"DetailItemGroup",props:{separated:{type:Boolean,default:!1}},setup(i){return(_,f)=>(a(),l("div",{class:j(["detail-item-group",{"detail-item-group_separated":i.separated}])},[X(_.$slots,"default",{},void 0,!0)],2))}},G=B(fe,[["__scopeId","data-v-98561949"]]),me={__name:"EditFeedDialog",props:L({feed:{type:Object,required:!0}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:L(["updated"],["update:modelValue"]),setup(i,{emit:_}){const f=oe(i,"modelValue"),m=i,C=_,h=q(),{request:n}=z(h,!0),s=J({credentialId:"",fileName:"",description:""}),v={credentialId:[P.required()],fileName:[P.required()]},S=[{key:"destination",label:"Destination",includes:["credentialId","fileName"]}],k=async()=>{await n(`/api/feeds/${m.feed.id}`,"PUT",{credential:{id:s.credentialId},file_name:s.fileName,description:s.description}),C("updated")};return K([()=>m.feed,f],()=>{var b;s.credentialId=((b=m.feed.credential)==null?void 0:b.id)||"",s.fileName=m.feed.file_name||"",s.description=m.feed.description||""},{immediate:!0}),(b,r)=>(a(),x(ne,{modelValue:f.value,"onUpdate:modelValue":r[3]||(r[3]=u=>f.value=u),form:s,onSubmit:k,rules:v,tabs:S,title:"Edit Feed",mode:"edit"},{destination:c(()=>[d(ie,{"credential-id":s.credentialId,"onUpdate:credentialId":r[0]||(r[0]=u=>s.credentialId=u),"file-name":s.fileName,"onUpdate:fileName":r[1]||(r[1]=u=>s.fileName=u),description:s.description,"onUpdate:description":r[2]||(r[2]=u=>s.description=u)},null,8,["credential-id","file-name","description"])]),_:1},8,["modelValue","form"]))}},ve={class:"link-button reset-button"},be={__name:"LinkButton",props:{text:{type:String,default:""}},setup(i){return(_,f)=>(a(),l("button",ve,[X(_.$slots,"default",{},()=>[A(E(i.text),1)],!0)]))}},H=B(be,[["__scopeId","data-v-fb10cc6c"]]),ke=i=>(Q("data-v-6192f044"),i=i(),Y(),i),ye={class:"uploads-table"},ge=["headers","totalItems","currentPage"],xe={key:0,class:"assistive-color"},he={key:3},Te=["iconName","iconColor","text"],Ie=ke(()=>p("span",{class:"dot-separator"},null,-1)),$e={key:4,class:"uploads-table__actions"},De=["backgroundColor","onClicked"],Ce=["color"],Se={__name:"UploadsTable",props:{feedId:{type:String,required:!0}},setup(i){const _=i,{items:f,page:m,total:C,load:h,loading:n,next:s,previous:v}=se(`/api/feeds/${_.feedId}/uploads`),S=t=>`${t}.zip`,k=t=>`/public/v1/reporting/reports/${t}/download`,b=N(()=>f.value.map(t=>({id:t.id,date:t.events.updated.at,report:t.report,status:Z[t.status],file:{name:S(t.report.id),size:re(t.size||0)},isFailed:t.status===ce.FAILED}))),r=N(()=>b.value.some(t=>t.isFailed)),u=N(()=>[{key:"date",text:"Date",width:"190px"},{key:"report",text:"Report"},{key:"file",text:"File",width:"165px"},{key:"status",text:"Status",width:"145px"},{key:"actions",width:r.value?"80px":"36px"}]),T=z(q()),V=async t=>{await T.request(`/api/feeds/${_.feedId}/uploads/${t.id}/retry`,"POST"),await h()},w=({report:t})=>ue(k(t.id)),U=t=>J([{icon:"googleRefreshBaseline",key:"retry",text:"Retry",loading:T.loading,handler:()=>V(t)}]);return h(),(t,g)=>(a(),l("div",ye,[e(n)?(a(),x(ee,{key:0})):(a(),l("ui-complex-table",{key:1,headers:u.value,totalItems:e(C),currentPage:e(m),fixed:"",onNextClicked:g[0]||(g[0]=(...o)=>e(s)&&e(s)(...o)),onPreviousClicked:g[1]||(g[1]=(...o)=>e(v)&&e(v)(...o))},[(a(!0),l(F,null,O(b.value,o=>(a(),l("tr",{key:o.id,class:"uploads-table__row"},[(a(!0),l(F,null,O(u.value,I=>(a(),l("td",{key:I.key},[I.key==="date"?(a(),x(R,{key:0,date:o.date},null,8,["date"])):I.key==="report"?(a(),x(y,{key:1},{"body-text":c(()=>[d(te,{to:e(W).reportDetails,params:o.report.id},{default:c(()=>[A(E(o.report.id),1)]),_:2},1032,["to","params"])]),_:2},1024)):I.key==="file"?(a(),l(F,{key:2},[o.isFailed?(a(),l("span",xe," — ")):(a(),x(y,{key:1,assistiveText:o.file.size},{"body-text":c(()=>[d(H,{text:o.file.name,onClick:ae=>w(o)},null,8,["text","onClick"])]),_:2},1032,["assistiveText"]))],64)):I.key==="status"?(a(),l("span",he,[p("ui-status",{iconName:o.status.icon,iconColor:o.status.color,text:o.status.text},null,8,Te),o.isFailed?(a(),l(F,{key:0},[Ie,d(H,{text:"Details"})],64)):D("",!0)])):I.key==="actions"?(a(),l("div",$e,[p("ui-button",{class:"actions-button",backgroundColor:e($).WHITE,height:"36px",width:"36px",onClicked:ae=>w(o)},[p("ui-icon",{class:"actions-button__trigger-icon",color:e($).TEXT,iconName:"googleFileDownloadBaseline"},null,8,Ce)],40,De),o.isFailed?(a(),x(_e,{key:0,actions:U(o)},null,8,["actions"])):D("",!0)])):D("",!0)]))),128))]))),128))],40,ge))]))}},we=B(Se,[["__scopeId","data-v-6192f044"]]),Fe=i=>(Q("data-v-e3c1e02f"),i=i(),Y(),i),Ne=["title"],Ue={slot:"actions",class:"header-actions"},Ee=["backgroundColor","color"],Be=Fe(()=>p("span",null,"Edit",-1)),Ve=[Be],Re=["backgroundColor"],qe=["color"],Ae={class:"header"},ze=["iconName","iconColor","text"],Le=["currentTab"],Oe={key:0,slot:"general",class:"general-tab"},Me={key:1,slot:"uploads",class:"uploads-tab"},Pe={__name:"FeedDetails",setup(i){const _=de(),f=le(),m=q(),{loading:C,request:h,result:n}=z(m),s=N(()=>_.params.id),v=N(()=>Z[n.status]),S=[{value:"general",label:"General"},{value:"uploads",label:"Uploads"}],k=M("general"),b=()=>{f.replace({name:"feeds"})},r=()=>h(`/api/feeds/${s.value}`),u=({detail:w})=>{k.value=w},T=M(!1),V=()=>{T.value=!0};return K(s,r,{immediate:!0}),(w,U)=>(a(),l("ui-view",{title:s.value,assistiveTitle:"Feed Details",style:{height:"inherit"},showBackButton:"",onGoBack:b},[e(C)?(a(),x(ee,{key:0})):(a(),l(F,{key:1},[p("div",Ue,[p("ui-button",{class:"header-button",backgroundColor:e($).WHITE,color:e($).TEXT,height:"36px",onClicked:V},Ve,40,Ee),d(pe,{feed:e(n),onEnabled:r,onDisabled:r,onUploaded:r,onDeleted:b},{default:c(()=>[p("ui-button",{class:"header-button header-button_menu",backgroundColor:e($).WHITE,height:"36px",width:"36px"},[p("ui-icon",{class:"header-button__trigger-icon",color:e($).TEXT,iconName:"googleArrowDropDownBaseline"},null,8,qe)],8,Re)]),_:1},8,["feed"])]),p("div",Ae,[d(G,null,{default:c(()=>[d(y,{title:"Report Schedule"},{"body-text":c(()=>{var t;return[d(te,{to:e(W).reportsScheduleDetails,params:(t=e(n).schedule)==null?void 0:t.id},{default:c(()=>{var g;return[A(E((g=e(n).schedule)==null?void 0:g.id),1)]}),_:1},8,["to","params"])]}),_:1}),d(y,{title:"Status"},{content:c(()=>[v.value?(a(),l("ui-status",{key:0,iconName:v.value.icon,iconColor:v.value.color,text:v.value.text},null,8,ze)):D("",!0)]),_:1})]),_:1})]),p("ui-tabs",{currentTab:k.value,tabs:S,onClickTab:u},[k.value==="general"?(a(),l("div",Oe,[d(y,{title:"Credentials",bodyText:e(n).credential.id},null,8,["bodyText"]),d(y,{title:"Description"},{"body-text":c(()=>[p("span",{class:j({"assistive-color":!e(n).description})},E(e(n).description||"—"),3)]),_:1}),d(G,{separated:""},{default:c(()=>[d(y,{title:"Created",assistiveText:e(n).events.created.by.id},{"body-text":c(()=>[d(R,{date:e(n).events.created.at},null,8,["date"])]),_:1},8,["assistiveText"]),d(y,{title:"Updated",assistiveText:e(n).events.updated.by.id},{"body-text":c(()=>[d(R,{date:e(n).events.updated.at},null,8,["date"])]),_:1},8,["assistiveText"])]),_:1})])):D("",!0),k.value==="uploads"?(a(),l("div",Me,[d(we,{feedId:s.value},null,8,["feedId"])])):D("",!0)],40,Le)],64)),d(me,{modelValue:T.value,"onUpdate:modelValue":U[0]||(U[0]=t=>T.value=t),feed:e(n),onUpdated:r},null,8,["modelValue","feed"])],40,Ne))}},je=B(Pe,[["__scopeId","data-v-e3c1e02f"]]);export{je as default};
